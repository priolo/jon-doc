"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[140],{6075:t=>{t.exports=JSON.parse('{"blogPosts":[{"id":"usesyncexternalstore","metadata":{"permalink":"/jon-doc/blog/usesyncexternalstore","source":"@site/blog/2022-10-07-usesyncexternalstore.md","title":"Don\'t shit and you use React18!","description":"Let\'s consider a simple ToDo","date":"2022-10-07T00:00:00.000Z","formattedDate":"October 7, 2022","tags":[{"label":"React18","permalink":"/jon-doc/blog/tags/react-18"},{"label":"hook","permalink":"/jon-doc/blog/tags/hook"},{"label":"useSyncExternalStore","permalink":"/jon-doc/blog/tags/use-sync-external-store"}],"readingTime":2.87,"hasTruncateMarker":false,"authors":[{"name":"Priolo","title":"Jon maintainer","url":"https://github.com/priolo","image_url":"https://github.com/priolo.png","imageURL":"https://github.com/priolo.png"}],"frontMatter":{"slug":"usesyncexternalstore","title":"Don\'t shit and you use React18!","authors":{"name":"Priolo","title":"Jon maintainer","url":"https://github.com/priolo","image_url":"https://github.com/priolo.png","imageURL":"https://github.com/priolo.png"},"tags":["React18","hook","useSyncExternalStore"]}},"content":"Let\'s consider a simple ToDo  \\nThis is what your colleague left you as a gift \ud83d\udca9 before going on holiday:  \\n\\n[codesandbox](https://codesandbox.io/s/to-do-vanilla-wgdgfg?file=/src/index.js)\\n\\nIn `index.js` there is a mess of functions within components passed between components that call other functions.  \\nAnd if it were a real project it would be MUCH MUCH worse  \\nbecause the COMPONENT TREE is **deeper**  \\nand the nesting of COMPONENTs multiplies the complexity! \\n\\n\\n### Let\'s create a STORE\\nLet us try to extrapolate the LOGIC and STATUS from the COMPONENTs  \\nto put it into a STORE.\\n\\n```js\\nconst myStore = {\\n\\t\\n\\tcallbacks: new Set(),\\n\\tsubscribe: (callback) => {\\n\\t\\tmyStore.callbacks.add(callback)\\n\\t\\treturn () => myStore.callbacks.delete(callback)\\n\\t},\\n\\tgetSnapshot: () => myStore.state,\\n\\tchangeState: (newState) => {\\n\\t\\tmyStore.state = newState\\n\\t\\tmyStore.callbacks.forEach( cb => cb() )\\n\\t},\\n\\n}\\n```\\n[codesandbox](https://codesandbox.io/s/to-do-usesyncexternalstore-brcpe3?file=/src/store.js:23-336)\\n\\nIt is a generic implementation of a STORE using [useSyncExternalStore](https://reactjs.org/docs/hooks-reference.html#usesyncexternalstore) \\nthe new React18 hook (but it can also be done with React17!).\\ntherefore:   \\n- `subscribe`  \\nStores a callback to be called when the STATE of the STORE is changed  \\n- `getSnapshot`  \\nReturns the current STATE   \\n- `changeState`  \\nIt is convenient to exchange one STATE for another STATE.   \\nRemember that a STATE is immutable!  \\nAnd notify all registered `callbacks` of the change \\n\\n\\n### Enter the STATE\\n\\n```js\\nconst myStore = {\\n\\t...\\n\\tstate: {\\n\\t\\ttodos: [\\n\\t\\t\\t{ desc : \\"init value\\" },\\n\\t\\t],\\n\\t\\ttodoInEdit: {\\n\\t\\t\\tdesc: \\"\\"\\n\\t\\t},\\n\\t},\\n\\t...\\n}\\n```\\n[codesandbox](https://codesandbox.io/s/to-do-usesyncexternalstore-brcpe3?file=/src/store.js:339-460)\\n\\nIt is a picture of what our VIEW, in this case the ToDo app, should look like.\\nA STATE represents one and only one view of the VIEW.\\n\\n### Enter the MUTATORS\\n\\n```js\\nconst myStore = {\\n\\t...\\n\\tsetTodos: todos => myStore.changeState({\\n\\t\\t...myStore.state,\\n\\t\\ttodos\\n\\t}),\\n\\tsetTodoInEditProp: prop => myStore.changeState({\\n\\t\\t...myStore.state,\\n\\t\\ttodoInEdit: { ...myStore.state.todoInEdit, ...prop }\\n\\t}),\\n\\t...\\n}\\n```\\n[codesandbox](https://codesandbox.io/s/to-do-usesyncexternalstore-brcpe3?file=/src/store.js:339-460)\\n\\nThey simply execute the `changeState` by passing it the modified STATE.\\nConsequently, they will notify the changes to the COMPONENTS.\\n(as said before)\\n\\n\\n### Let\'s add the ACTIONS\\n\\n```js\\nconst myStore = {\\n\\t...\\n\\tdeleteTodo: (index) => {\\n\\t\\tconst newTodos = myStore.state.todos.filter ((_,i)=>i!==index)\\n\\t\\tmyStore.setTodos(newTodos)\\n\\t},\\n\\taddTodoInEdit: () => {\\n\\t\\tconst newTodos = [...myStore.state.todos, myStore.state.todoInEdit]\\n\\t\\tmyStore.setTodos(newTodos)\\n\\t\\tmyStore.setTodoInEditProp({desc: \\"\\"}) \\n\\t},\\n\\t...\\n}\\n```\\n[codesandbox](https://codesandbox.io/s/to-do-usesyncexternalstore-brcpe3?file=/src/store.js:483-773)\\n\\n\\n### Let\'s update the VIEW\\n\\n```jsx\\nfunction App() {\\n\\treturn (<div>\\n\\t\\t<List />\\n\\t\\t<Form />\\n\\t</div>);\\n}\\n\\nfunction List() {\\n\\tconst state = useSyncExternalStore(store.subscribe, store.getSnapshot)\\n\\n\\treturn (\\n\\t\\t<ul>\\n\\t\\t\\t{state.todos.map((td, index) => (<li>\\n\\t\\t\\t\\t{td.desc}\\n\\t\\t\\t\\t<button onClick={_=>store.deleteTodo(index)}>\\n\\t\\t\\t\\t\\tDelete\\n\\t\\t\\t\\t</button>\\n\\t\\t\\t</li>))}\\n\\t\\t</ul>\\n\\t)\\n}\\n\\nfunction Form() {\\n\\tconst state = useSyncExternalStore(store.subscribe, store.getSnapshot)\\n\\tconst handleChange = e => store.setTodoInEditProp({desc:e.target.value})\\n\\tconst handleClickAdd = _ => store.addTodoInEdit()\\n\\n\\treturn (<div>\\n\\t\\t<input\\n\\t\\t\\tvalue={state.todoInEdit.desc}\\n\\t\\t\\tonChange={handleChange}\\n\\t\\t/>\\n\\t\\t<button onClick={handleClickAdd}>Add</button>\\n\\t</div>)\\n}\\n```\\n[codesandbox](https://codesandbox.io/s/to-do-usesyncexternalstore-brcpe3?file=/src/index.js:130-828)\\n\\nThe STORE is responsible for managing the LOGIC and the STATE  \\nthe VIEW simply synchronises with the STORE  \\n\\nThe COMPONENTS are more readable\\n\\nand can be moved without problems.\\nFor example, `List` can be put inside another component without changing anything  \\nbecause it is no longer \\"dependent\\" on its PARENT  \\nIn fact `List` has no properties  \\n\\nthis also makes unit-testing easier.  \\n\\nIn short, if I have to change the behavior I have to look at the STOREs.  \\nIf I have to change the display I will have to act on the COMPONENTS   \\n\\n\\n## Jon\\n\\nThere are many libraries in React (as usual) that allow STATE management.  \\nOf course I made one \ud83d\ude03  \\nIn my opinion, compared to the others, it allows  \\n1) to see perfectly how it works under the hood. NO MAGIC  \\n2) is super light  \\n3) does only this, and nothing else  \\n  \\nIf you want, check it out [here](https://priolo.github.io/jon-doc/)"}]}')}}]);